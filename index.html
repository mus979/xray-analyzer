<script>
  const input = document.getElementById('xray');
  const filenameDiv = document.getElementById('filename');
  const resultDiv = document.getElementById('result');

  input.addEventListener('change', () => {
    const file = input.files[0];
    filenameDiv.textContent = file ? "تم اختيار الملف: " + file.name : "";
  });

  async function showResult() {
    const file = input.files[0];
    if (!file) {
      alert('يرجى اختيار صورة أولاً.');
      return;
    }

    const formData = new FormData();
    formData.append('image', file);

    resultDiv.style.display = 'block';
    resultDiv.innerHTML = '⏳ جاري تحليل الصورة...';

    try {
      const response = await fetch('https://xray-analyzer-api.replit.app/analyze', {
        method: 'POST',
        body: formData
      });

      const data = await response.json();
      resultDiv.innerHTML = `
        <h3>✅ نتيجة التحليل:</h3>
        <p><strong>${data.diagnosis}</strong></p>
        <p>نسبة الثقة: ${data.confidence}</p>
      `;
    } catch (error) {
      resultDiv.innerHTML = '❌ حدث خطأ أثناء التحليل، يرجى المحاولة لاحقًا.';
      console.error(error);
    }
  }
</script>